@using FirstStep.Models
@using RetrogameWeb.Data.Entities

@model FirstStep.Models.ViewModel.CallBackVM

@{
    ViewBag.Title = "Redirect";
}

<h2>CallBack</h2>
<div>Code: @Model.InstagramCode</div>

<h2>User info:</h2>
<div>Token: @Model.AuthorizationToken</div>
<div>Username: @Model.UserName</div>

@Html.DropDownList("City", Model.Cities)
<input type="button" value="Go" id="btnGo" />
    
@if (Model.Images != null) {
    @*<div>
        @foreach (InstagramImage img in Model.Images)
        {
            <div style="float: left">
                <img src="@img.Url" alt="@img.Caption" title="@img.Caption" />
            </div>
        }
    </div>*@
    @Html.Partial("Shared/Images", Model)
}

<div id="images"></div>

<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

<script type="text/javascript">
    $('#btnGo').click(function() {

        var citySelected = $('#City option:selected').text();

        $.ajax({
            type: "GET",
            url: '@Url.Action("GetListImages", "Instagram")',
            contentType: "application/json; charset=utf-8",
            data: { cityName: citySelected },
            dataType: "json",
            success: function(data) {

                var div = "";
                var i;

                // Get div containing images
                for (i in data) {
                    div += "<img src=" + data[i].Url + " alt=" + data[i].Caption + " />";
                }

                // Empty and append new div
                $('#images').empty();
                $('#images').append(div);

            },
            error: function() { alert('error'); }
        });
    });
</script>